<div class="mis-casos-container">
  <!-- Header -->
  <div class="mb-4">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h2 class="h4 mb-2">Mis Casos Judiciales</h2>
        <p class="text-muted mb-0">Consulta el estado y seguimiento de tus casos</p>
      </div>
      <div class="d-flex align-items-center">
        <span class="text-muted me-3">Total: {{ totalCasos }} casos</span>
        <button label="Buscar Caso" 
           
          class="btn btn-primary"
          (click)="mostrarBusqueda = !mostrarBusqueda">
        </button>
      </div>
    </div>
  </div>

  <!-- Búsqueda rápida -->
  <div *ngIf="mostrarBusqueda" class="card mb-4">
    <div class="card-body">
      <div class="row g-3 align-items-center">
        <div class="col-md-8">
          <div class="input-group">
            <span class="input-group-text">
              <i class="pi pi-search"></i>
            </span>
            <input pInputText 
              [(ngModel)]="busqueda" 
              placeholder="Buscar por número de caso, abogado o tipo..."
              class="form-control"
              (keyup.enter)="filtrarCasos()">
          </div>
        </div>
        <div class="col-md-4">
          <div class="d-flex gap-2">
            <button label="Buscar" 
               
              class="flex-grow-1"
              (click)="filtrarCasos()">
            </button>
            <button label="Limpiar" 
               
              class="btn btn-primary"
              (click)="limpiarBusqueda()">
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Casos activos -->
  <div class="card mb-4">
    <div class="card-header">
      <h5 class="mb-0">Casos en Proceso</h5>
    </div>
    <div class="card-body">
      <div *ngIf="casosActivos.length === 0" class="text-center py-5">
        <i class="pi pi-check-circle" style="font-size: 3rem; color: #28a745;"></i>
        <p class="text-muted mt-3">No tienes casos en proceso actualmente</p>
      </div>

      <div class="row g-3" *ngIf="casosActivos.length > 0">
        <div class="col-md-6" *ngFor="let caso of casosActivos">
          <div class="card h-100 border-start caso-card" 
               [ngClass]="{
                 'border-warning': caso.nivelUrgencia === 'Próximo',
                 'border-danger': caso.nivelUrgencia === 'Urgente',
                 'border-success': caso.nivelUrgencia === 'Normal'
               }">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start mb-3">
                <div>
                  <h6 class="card-title mb-1">{{ caso.numeroCaso }}</h6>
                  <p class="text-muted small mb-0">{{ caso.tipoCaso }}</p>
                </div>
                <div>
                  <span class="badge me-1" [ngClass]="getEstadoClass(caso.estado)">{{ caso.estado }}</span>
                  <span class="badge" [ngClass]="getUrgenciaClass(caso.nivelUrgencia)">{{ caso.nivelUrgencia }}</span>
                </div>
              </div>
              
              <div class="mb-3">
                <p class="card-text small">{{ caso.opcionLlenado || 'Sin descripción disponible' }}</p>
              </div>
              
              <div class="row g-2">
                <div class="col-6">
                  <div class="text-muted small">Abogado</div>
                  <div class="fw-semibold">{{ caso.abogado }}</div>
                </div>
                <div class="col-6">
                  <div class="text-muted small">Vencimiento</div>
                  <div [ngClass]="{
                    'text-danger fw-bold': caso.diasRestantes <= 3,
                    'text-warning': caso.diasRestantes > 3 && caso.diasRestantes <= 7
                  }">
                    {{ caso.fechaVencimiento | date:'dd/MM/yyyy' }}
                    <span class="text-muted small">({{ caso.diasRestantes }} días)</span>
                  </div>
                </div>
              </div>
              
              <div class="mt-3">
                <button label="Ver Detalles" 
                   
                  class="btn btn-primary"
                  [routerLink]="['/usuario/caso', caso.idRegistro]">
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabla completa -->
  <div class="card">
    <div class="card-header">
      <h5 class="mb-0">Todos Mis Casos</h5>
    </div>
    <div class="card-body">
      <table class="table">
        
        <ng-template>
          <tr>
            <th>N° Caso</th>
            <th>Abogado</th>
            <th>Tipo</th>
            <th>Ingreso</th>
            <th>Vencimiento</th>
            <th>Estado</th>
            <th>Urgencia</th>
            <th>Acciones</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-caso>
          <tr>
            <td class="fw-semibold">{{ caso.numeroCaso }}</td>
            <td>{{ caso.abogado }}</td>
            <td>{{ caso.tipoCaso }}</td>
            <td>{{ caso.fechaIngreso | date:'dd/MM/yyyy' }}</td>
            <td>
              <div [ngClass]="{
                'text-danger fw-bold': caso.diasRestantes <= 3,
                'text-warning': caso.diasRestantes > 3 && caso.diasRestantes <= 7
              }">
                {{ caso.fechaVencimiento | date:'dd/MM/yyyy' }}
              </div>
              <div class="text-muted small">{{ caso.diasRestantes }} días</div>
            </td>
            <td>
              <span [class]="'badge ' + getEstadoClass(caso.estado)">{{ caso.estado }}</span>
            </td>
            <td>
              <span [class]="'badge ' + getUrgenciaClass(caso.nivelUrgencia)">{{ caso.nivelUrgencia }}</span>
            </td>
            <td>
              <button  
                class="btn btn-primary"
                [routerLink]="['/usuario/caso', caso.idRegistro]"
                >
              </button>
            </td>
          </tr>
        </ng-template>

        <ng-template>
          <tr>
            <td colspan="8" class="text-center py-4">
              <i class="pi pi-folder me-2"></i>
              No tienes casos registrados
            </td>
          </tr>
        </ng-template>
      </table>
    </div>
  </div>

  <!-- Resumen -->
  <div class="row mt-4">
    <div class="col-md-3">
      <div class="card bg-primary text-white">
        <div class="card-body text-center">
          <i class="pi pi-briefcase mb-2" style="font-size: 2rem"></i>
          <h3 class="mb-1">{{ totalCasos }}</h3>
          <p class="mb-0 small">Total de Casos</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-warning text-white">
        <div class="card-body text-center">
          <i class="pi pi-clock mb-2" style="font-size: 2rem"></i>
          <h3 class="mb-1">{{ casosPendientes }}</h3>
          <p class="mb-0 small">Pendientes</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-info text-white">
        <div class="card-body text-center">
          <i class="pi pi-cog mb-2" style="font-size: 2rem"></i>
          <h3 class="mb-1">{{ casosEnProceso }}</h3>
          <p class="mb-0 small">En Proceso</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-success text-white">
        <div class="card-body text-center">
          <i class="pi pi-check-circle mb-2" style="font-size: 2rem"></i>
          <h3 class="mb-1">{{ casosFinalizados }}</h3>
          <p class="mb-0 small">Finalizados</p>
        </div>
      </div>
    </div>
  </div>
</div>
