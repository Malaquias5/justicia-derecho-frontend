<div class="estadisticas-container">
  <!-- Header -->
  <div class="mb-4">
    <h2 class="h4 mb-2">Estadísticas del Sistema</h2>
    <p class="text-muted">Análisis detallado del rendimiento y actividad</p>
  </div>

  <!-- Filtros -->
  <div class="card mb-4">
    <div class="card-body">
      <div class="row g-3 align-items-center">
        <div class="col-md-3">
          <label class="form-label">Período</label>
          <select class="form-select" [(ngModel)]="periodo" (change)="cargarEstadisticas()">
            <option value="30">Últimos 30 días</option>
            <option value="90">Últimos 3 meses</option>
            <option value="180">Últimos 6 meses</option>
            <option value="365">Último año</option>
          </select>
        </div>
        <div class="col-md-9 d-flex justify-content-end">
          <div class="btn-group">
            <button label="Exportar PDF"  class="me-2"></button>
            <button label="Exportar Excel" ></button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Estadísticas principales -->
  <div class="row mb-4">
    <div class="col-md-3 mb-3">
      <div class="card border-start border-primary border-4">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-muted mb-2">Total Usuarios</h6>
              <h3 class="mb-0">{{ estadisticas?.totalUsuarios || 0 }}</h3>
            </div>
            <i class="pi pi-users text-primary" style="font-size: 2rem"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card border-start border-success border-4">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-muted mb-2">Total Casos</h6>
              <h3 class="mb-0">{{ estadisticas?.totalCasos || 0 }}</h3>
            </div>
            <i class="pi pi-folder text-success" style="font-size: 2rem"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card border-start border-warning border-4">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-muted mb-2">Casos Activos</h6>
              <h3 class="mb-0">{{ estadisticas?.casosActivos || 0 }}</h3>
            </div>
            <i class="pi pi-briefcase text-warning" style="font-size: 2rem"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card border-start border-danger border-4">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-muted mb-2">Casos Vencidos</h6>
              <h3 class="mb-0">{{ estadisticas?.casosVencidos || 0 }}</h3>
            </div>
            <i class="pi pi-exclamation-triangle text-danger" style="font-size: 2rem"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Gráficos -->
  <div class="row mb-4">
    <div class="col-md-8 mb-3">
      <div class="card h-100">
        <div class="card-header">
          <h5 class="mb-0">Casos por abogado</h5>
        </div>
        <div class="card-body">
          <div *ngIf="estadisticas?.estadisticasAbogados?.length; else sinDatosAbogados">
            <div class="mb-3" *ngFor="let e of estadisticas!.estadisticasAbogados">
              <div class="d-flex justify-content-between mb-1">
                <span class="fw-semibold">{{ e.abogado }}</span>
                <span class="text-muted">{{ e.totalCasos }} casos</span>
              </div>
              <div class="progress" style="height: 12px;">
                <div
                  class="progress-bar bg-primary"
                  role="progressbar"
                  [style.width.%]="maxCasosAbogado ? (e.totalCasos / maxCasosAbogado) * 100 : 0"
                ></div>
              </div>
            </div>
          </div>
          <ng-template #sinDatosAbogados>
            <p class="text-muted mb-0">No hay estadísticas de abogados para el período seleccionado.</p>
          </ng-template>
        </div>
      </div>
    </div>
    <div class="col-md-4 mb-3">
      <div class="card">
        <ul class="list-group list-group-flush">
          <li class="list-group-item d-flex justify-content-between align-items-center">
            Administradores
            <span class="badge bg-primary rounded-pill">{{ estadisticas?.totalAdmin || 0 }}</span>
          </li>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            Abogados
            <span class="badge bg-info rounded-pill">{{ estadisticas?.totalAbogados || 0 }}</span>
          </li>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            Usuarios
            <span class="badge bg-success rounded-pill">{{ estadisticas?.totalUsuariosNormales || 0 }}</span>
          </li>
        </ul>
      </div>
    </div>
  </div>

</div>
