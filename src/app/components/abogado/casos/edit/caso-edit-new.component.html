<div class="caso-edit-container p-4">
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a [routerLink]="['/abogado/casos']">Casos</a></li>
      <li class="breadcrumb-item"><a [routerLink]="['/abogado/casos', id]">{{ caso?.numeroCaso }}</a></li>
      <li class="breadcrumb-item active">Editar</li>
    </ol>
  </nav>

  <!-- Header con alerta amarilla -->
  <div class="alert alert-warning mb-4" role="alert">
    <i class="bi bi-pencil-square me-2"></i>
    <strong>Editar Caso: {{ caso?.numeroCaso }}</strong>
  </div>

  <!-- Nota informativa -->
  <div class="alert alert-info" role="alert">
    <i class="bi bi-info-circle me-2"></i>
    <strong>Nota:</strong> El número de caso no puede ser modificado. Los cambios quedarán registrados en el historial.
  </div>

  <!-- Formulario -->
  <form [formGroup]="casoForm" (ngSubmit)="onSubmit()">
    <div class="row g-4">
      <!-- Columna Izquierda: Información del Caso -->
      <div class="col-lg-6">
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="bi bi-person me-2"></i>Información del Caso</h5>
          </div>
          <div class="card-body p-4">
            <!-- Número de Caso (readonly) -->
            <div class="mb-3">
              <label class="form-label fw-semibold">
                <i class="bi bi-hash me-1"></i>Número de Caso
              </label>
              <input 
                type="text" 
                class="form-control form-control-lg bg-light" 
                [value]="caso?.numeroCaso"
                readonly>
              <small class="text-muted">Este campo no puede ser modificado</small>
            </div>

            <!-- Abogado Responsable (readonly) -->
            <div class="mb-3">
              <label class="form-label fw-semibold">
                <i class="bi bi-person-badge me-1"></i>Abogado Responsable
              </label>
              <input 
                type="text" 
                class="form-control form-control-lg bg-light" 
                [value]="caso?.abogado"
                readonly>
              <small class="text-muted">Este campo no puede ser modificado</small>
            </div>

            <!-- Patrocinado (EDITABLE) -->
            <div class="mb-3">
              <label class="form-label fw-semibold">
                Patrocinado (Cliente) <span class="text-danger">*</span>
              </label>
              <input 
                type="text" 
                class="form-control form-control-lg" 
                formControlName="patrocinado"
                placeholder="Nombre del cliente"
                [class.is-invalid]="casoForm.get('patrocinado')?.invalid && casoForm.get('patrocinado')?.touched">
              <div class="invalid-feedback" *ngIf="casoForm.get('patrocinado')?.hasError('required')">
                Este campo es requerido
              </div>
            </div>

            <!-- Tipo de Caso (readonly) -->
            <div class="mb-3">
              <label class="form-label fw-semibold">
                <i class="bi bi-tag me-1"></i>Tipo de Caso <span class="text-danger">*</span>
              </label>
              <select class="form-select form-select-lg bg-light" disabled>
                <option>{{ caso?.tipoCaso }}</option>
              </select>
            </div>

            <!-- Dependencia (readonly con botones) -->
            <div class="mb-3">
              <label class="form-label fw-semibold">
                <i class="bi bi-building me-1"></i>Dependencia <span class="text-danger">*</span>
              </label>
              <div class="d-flex gap-2">
                <button 
                  type="button"
                  class="btn btn-lg flex-fill"
                  [class.btn-primary]="caso?.dependencia === 'COMISARIA'"
                  [class.btn-outline-secondary]="caso?.dependencia !== 'COMISARIA'"
                  disabled>
                  <i class="bi bi-shield-fill me-2"></i>COMISARIA
                </button>
                <button 
                  type="button"
                  class="btn btn-lg flex-fill"
                  [class.btn-success]="caso?.dependencia === 'FISCALIA'"
                  [class.btn-outline-secondary]="caso?.dependencia !== 'FISCALIA'"
                  disabled>
                  <i class="bi bi-bank me-2"></i>FISCALIA
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Columna Derecha: Fechas y Estado -->
      <div class="col-lg-6">
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="bi bi-calendar3 me-2"></i>Fechas y Estado</h5>
          </div>
          <div class="card-body p-4">
            <!-- Fecha de Ingreso (readonly) -->
            <div class="mb-3">
              <label class="form-label fw-semibold">
                <i class="bi bi-calendar-check me-1"></i>Fecha de Ingreso <span class="text-danger">*</span>
              </label>
              <input 
                type="text" 
                class="form-control form-control-lg bg-light" 
                [value]="formatDateDisplay(caso?.fechaIngreso)"
                readonly>
            </div>

            <!-- Fecha de Vencimiento (readonly) -->
            <div class="mb-3">
              <label class="form-label fw-semibold">
                <i class="bi bi-calendar-x me-1"></i>Fecha de Vencimiento <span class="text-danger">*</span>
              </label>
              <input 
                type="text" 
                class="form-control form-control-lg bg-light" 
                [value]="formatDateDisplay(caso?.fechaVencimiento)"
                readonly>
              <small class="text-muted">Fecha límite para presentar documentos</small>
            </div>

            <!-- Estado Actual (readonly) -->
            <div class="mb-3">
              <label class="form-label fw-semibold">
                <i class="bi bi-circle-fill me-1"></i>Estado Actual
              </label>
              <input 
                type="text" 
                class="form-control form-control-lg bg-light" 
                [value]="caso?.estado"
                readonly>
              <small class="text-muted">Para cambiar el estado, use el botón "Cambiar Estado" en la vista de detalle</small>
            </div>

            <!-- Descripción del Caso (EDITABLE) -->
            <div class="mb-3">
              <label class="form-label fw-semibold">
                <i class="bi bi-file-text me-1"></i>Descripción del Caso
              </label>
              <textarea 
                class="form-control" 
                formControlName="opcionLlenado"
                rows="5"
                maxlength="200"
                placeholder="Descripción detallada del caso, hechos relevantes, etc."></textarea>
              <small class="text-muted">Máximo 200 caracteres</small>
            </div>

            <!-- Info de registro -->
            <div class="alert alert-light mt-4">
              <div class="d-flex align-items-center mb-2">
                <i class="bi bi-person-circle me-2"></i>
                <strong>Registrado:</strong> {{ formatDateDisplay(caso?.fechaRegistro, true) }}
              </div>
              <div class="d-flex align-items-center">
                <i class="bi bi-person-fill me-2"></i>
                <strong>Por:</strong> {{ caso?.usuarioRegistro }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Botones de acción -->
    <div class="row mt-4">
      <div class="col-12">
        <div class="d-flex justify-content-between">
          <button 
            type="button" 
            class="btn btn-secondary btn-lg"
            (click)="cancelar()">
            <i class="bi bi-arrow-left me-2"></i>Cancelar
          </button>
          <div class="d-flex gap-2">
            <button 
              type="submit" 
              class="btn btn-warning btn-lg"
              [disabled]="casoForm.invalid || isLoading || !casoForm.dirty">
              <i class="bi bi-save me-2"></i>
              {{ isLoading ? 'Guardando...' : 'Guardar Cambios' }}
            </button>
            <button 
              type="button" 
              class="btn btn-info btn-lg"
              [routerLink]="['/abogado/casos', id]">
              <i class="bi bi-eye me-2"></i>Ver Detalle
            </button>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>
