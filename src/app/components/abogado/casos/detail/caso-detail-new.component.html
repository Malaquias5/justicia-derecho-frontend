<div class="caso-detail-container p-4">
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a [routerLink]="['/abogado/casos']">Casos</a></li>
      <li class="breadcrumb-item active">{{ caso?.numeroCaso }}</li>
    </ol>
  </nav>

  <!-- Header del caso -->
  <div class="d-flex justify-content-between align-items-start mb-4">
    <div>
      <h2 class="h3 mb-2">
        <i class="bi bi-folder-fill text-primary me-2"></i>{{ caso?.numeroCaso }}
      </h2>
      <p class="text-muted mb-0">
        <i class="bi bi-person me-1"></i><strong>Cliente:</strong> {{ caso?.patrocinado }}
      </p>
    </div>
    <div class="d-flex gap-2 align-items-center">
      <span 
        class="badge badge-lg"
        [ngClass]="{
          'bg-info': caso?.estado === 'En Proceso',
          'bg-warning text-dark': caso?.estado === 'Pendiente',
          'bg-success': caso?.estado === 'Finalizado'
        }">
        {{ caso?.estado }}
      </span>
      <span 
        class="badge badge-lg bg-danger"
        *ngIf="caso?.diasRestantes !== undefined && caso?.diasRestantes <= 15">
        Vencido hace {{ Math.abs(caso?.diasRestantes) }} día(s)
      </span>
    </div>
  </div>

  <!-- Botones de acción principales -->
  <div class="d-flex gap-2 mb-4">
    <button 
      class="btn btn-warning"
      [routerLink]="['/abogado/casos', id, 'editar']">
      <i class="bi bi-pencil-square me-2"></i>Editar
    </button>
    <button 
      class="btn btn-primary"
      (click)="cambiarEstado()">
      <i class="bi bi-arrow-repeat me-2"></i>Cambiar Estado
    </button>
    <button 
      class="btn btn-secondary"
      routerLink="/abogado/casos">
      <i class="bi bi-arrow-left me-2"></i>Volver
    </button>
  </div>

  <div class="row">
    <!-- Columna Izquierda: Información del Caso -->
    <div class="col-lg-7 mb-4">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-primary text-white py-3">
          <h5 class="mb-0">
            <i class="bi bi-info-circle me-2"></i>Información del Caso
          </h5>
        </div>
        <div class="card-body p-4">
          <div class="row g-3">
            <!-- Abogado -->
            <div class="col-md-6">
              <label class="form-label text-muted fw-semibold mb-1">
                <i class="bi bi-person-badge me-1"></i>Abogado:
              </label>
              <p class="mb-0">{{ caso?.abogado }}</p>
            </div>

            <!-- Tipo -->
            <div class="col-md-6">
              <label class="form-label text-muted fw-semibold mb-1">
                <i class="bi bi-tag me-1"></i>Tipo:
              </label>
              <p class="mb-0">{{ caso?.tipoCaso }}</p>
            </div>

            <!-- Dependencia -->
            <div class="col-md-6">
              <label class="form-label text-muted fw-semibold mb-1">
                <i class="bi bi-building me-1"></i>Dependencia:
              </label>
              <p class="mb-0">
                <span 
                  class="badge"
                  [ngClass]="{
                    'bg-primary': caso?.dependencia === 'COMISARIA',
                    'bg-success': caso?.dependencia === 'FISCALIA'
                  }">
                  {{ caso?.dependencia }}
                </span>
              </p>
            </div>

            <!-- Ingreso -->
            <div class="col-md-6">
              <label class="form-label text-muted fw-semibold mb-1">
                <i class="bi bi-calendar-check me-1"></i>Ingreso:
              </label>
              <p class="mb-0">{{ formatDate(caso?.fechaIngreso) }}</p>
            </div>

            <!-- Vencimiento -->
            <div class="col-md-6">
              <label class="form-label text-muted fw-semibold mb-1">
                <i class="bi bi-calendar-x me-1"></i>Vencimiento:
              </label>
              <p class="mb-0">{{ formatDate(caso?.fechaVencimiento) }}</p>
            </div>

            <!-- Descripción -->
            <div class="col-12 mt-4">
              <label class="form-label text-muted fw-semibold mb-2">
                <i class="bi bi-file-text me-1"></i>Descripción:
              </label>
              <div class="alert alert-light mb-0">
                <p class="mb-0">{{ caso?.opcionLlenado || 'Sin descripción' }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Columna Derecha: Timeline de Seguimientos y Documentos -->
    <div class="col-lg-5 mb-4">
      <!-- Timeline de Seguimientos -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-info text-white py-3 d-flex justify-content-between align-items-center">
          <h5 class="mb-0">
            <i class="bi bi-clock-history me-2"></i>Timeline de Seguimientos
          </h5>
          <button 
            class="btn btn-light btn-sm"
            (click)="mostrarModalSeguimiento()">
            <i class="bi bi-plus-circle me-1"></i>Agregar
          </button>
        </div>
        <div class="card-body p-3">
          <div *ngIf="seguimientos.length === 0" class="text-center py-4">
            <i class="bi bi-inbox text-muted" style="font-size: 2.5rem;"></i>
            <p class="text-muted mt-2 mb-0">No hay seguimientos registrados</p>
          </div>

          <!-- Lista de seguimientos -->
          <div *ngFor="let seg of seguimientos" class="border-bottom pb-3 mb-3">
            <div class="d-flex align-items-start">
              <i class="bi bi-circle-fill text-primary me-2" style="font-size: 0.5rem; margin-top: 6px;"></i>
              <div class="flex-grow-1">
                <h6 class="mb-1">
                  <i class="bi bi-megaphone me-1"></i>{{ seg.tipoMovimiento }}
                </h6>
                <p class="mb-1 small">{{ seg.descripcion }}</p>
                <div class="d-flex justify-content-between align-items-center">
                  <small class="text-muted">
                    <i class="bi bi-person me-1"></i>{{ seg.usuario }}
                  </small>
                  <small class="text-muted">
                    {{ formatDate(seg.fechaMovimiento, true) }}
                  </small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Documentos Adjuntos -->
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-success text-white py-3 d-flex justify-content-between align-items-center">
          <h5 class="mb-0">
            <i class="bi bi-paperclip me-2"></i>Documentos Adjuntos
          </h5>
          <button 
            class="btn btn-light btn-sm"
            (click)="mostrarModalDocumento()">
            <i class="bi bi-plus-circle me-1"></i>Agregar
          </button>
        </div>
        <div class="card-body p-3">
          <div *ngIf="documentos.length === 0" class="text-center py-4">
            <i class="bi bi-folder-x text-muted" style="font-size: 2.5rem;"></i>
            <p class="text-muted mt-2 mb-0">No hay documentos adjuntos</p>
          </div>

          <!-- Lista de documentos -->
          <div *ngFor="let doc of documentos" class="border-bottom pb-2 mb-2">
            <div class="d-flex align-items-center justify-content-between">
              <div class="d-flex align-items-center">
                <i class="bi bi-file-earmark-pdf text-danger me-2" style="font-size: 1.5rem;"></i>
                <div>
                  <h6 class="mb-0">{{ doc.nombreArchivo }}</h6>
                  <small class="text-muted">{{ formatBytes(doc.tamanoArchivo) }}</small>
                </div>
              </div>
              <button class="btn btn-sm btn-outline-primary">
                <i class="bi bi-download"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal para agregar seguimiento -->
<div class="modal fade" id="modalSeguimiento" tabindex="-1" *ngIf="showModalSeguimiento">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-info text-white">
        <h5 class="modal-title">
          <i class="bi bi-plus-circle me-2"></i>Agregar Seguimiento
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="cerrarModalSeguimiento()"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="seguimientoForm">
          <div class="mb-3">
            <label class="form-label">Tipo de Movimiento: <span class="text-danger">*</span></label>
            <select class="form-select" formControlName="tipoMovimiento">
              <option value="">-- Seleccione --</option>
              <option value="Audiencia">Audiencia</option>
              <option value="Presentación de Documentos">Presentación de Documentos</option>
              <option value="Resolución">Resolución</option>
              <option value="Citación">Citación</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Descripción:</label>
            <textarea 
              class="form-control" 
              formControlName="descripcion"
              rows="4"
              placeholder="Descripción detallada del evento..."></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="cerrarModalSeguimiento()">Cancelar</button>
        <button type="button" class="btn btn-info" (click)="guardarSeguimiento()">
          <i class="bi bi-save me-2"></i>Guardar
        </button>
      </div>
    </div>
  </div>
</div>
<div class="modal-backdrop fade show" *ngIf="showModalSeguimiento" (click)="cerrarModalSeguimiento()"></div>
